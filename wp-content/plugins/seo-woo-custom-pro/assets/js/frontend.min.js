function wcpaInitMap(){var e={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"};jQuery(".wcpa_type_placeselector").each((function(){var a=jQuery(this).find(".wcpa_google_place").get(0),t=jQuery(this),i=new google.maps.places.Autocomplete(a);""!=wcpa_global_vars.google_map_countries&&Array.isArray(wcpa_global_vars.google_map_countries)&&i.setComponentRestrictions({country:wcpa_global_vars.google_map_countries});var r=new google.maps.Geocoder;if(i.addListener("place_changed",(function(){var a=i.getPlace();for(var r in e)jQuery("."+r,t).val(""),jQuery("."+r,t).removeAttr("disabled","disabled");for(var p=0;p<a.address_components.length;p++){var n=a.address_components[p].types[0];if(e[n]){var c=a.address_components[p][e[n]];jQuery("."+n,t).val(c)}}a.geometry&&(jQuery(".wcpa_lat",t).val(a.geometry.location.lat()),jQuery(".wcpa_lng",t).val(a.geometry.location.lng()))})),t.find(".wcpa_map").length){var p=new google.maps.Map(t.find(".wcpa_map").get(0),{center:{lat:0,lng:0},zoom:15});i.bindTo("bounds",p);var n=new google.maps.Marker({map:p,draggable:!0,anchorPoint:new google.maps.Point(0,-29)});jQuery.post("https://www.googleapis.com/geolocation/v1/geolocate?key="+wcpa_global_vars.google_map_api,(function(e){p.setCenter(e.location),n.setVisible(!1),n.setPosition(e.location),n.setVisible(!0)})),google.maps.event.addListener(n,"dragend",(function(){jQuery(".wcpa_lat",t).val(n.getPosition().lat()),jQuery(".wcpa_lng",t).val(n.getPosition().lng()),r.geocode({latLng:n.getPosition()},(function(a){for(var i in e)jQuery("."+i,t).val(""),jQuery("."+i,t).removeAttr("disabled","disabled");if(a&&a.length>0){jQuery(".wcpa_google_place",t).val(a[0].formatted_address),jQuery.wcpaIterate();for(var r=0;r<a[0].address_components.length;r++){var p=a[0].address_components[r].types[0];if(e[p]){var n=a[0].address_components[r][e[p]];jQuery("."+p,t).val(n)}}}}))})),i.addListener("place_changed",(function(){n.setVisible(!1);var e=i.getPlace();e.geometry?(e.geometry.viewport?p.fitBounds(e.geometry.viewport):(p.setCenter(e.geometry.location),p.setZoom(17)),n.setPosition(e.geometry.location),n.setVisible(!0)):window.alert("No details available for input: '"+e.name+"'")}))}}))}String.prototype.endsWith||(String.prototype.endsWith=function(e,a){return(void 0===a||a>this.length)&&(a=this.length),this.substring(a-e.length,a)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e,a){return this.substr(!a||a<0?0:+a,e.length)===e}),function($){function wcpa_product_image_update(e,a){if(0!=a){var t=a.data("image"),i={image:t};$.extend(i,{image:t}),null!=t.image_id&&$.extend(i,{image_id:t.image_id}),e.wc_variations_image_update(i),e.data("wcpa_product_image",!0);var r=e.closest(".product, .product-col"),p=r.find(".product-image-slider"),n=r.find(".product-thumbs-slider");p.length&&p.trigger("to.owl.carousel",[0,100,!0]),n.length&&n.trigger("to.owl.carousel",[0,100,!0]);var c=r.find("div.product-images .woocommerce-main-image").length?r.find("div.product-images .woocommerce-main-image"):$(".single-product div.product-images .woocommerce-main-image");c&&c.length&&(c.attr("src",t.src),c.attr("srcset",""),c.attr("alt",t.title),c.attr("href",t.full_src)),e.find(".wcpa_form_outer").trigger("wcpa_product_image_changed",[i])}else 1==e.data("wcpa_product_image")&&(e.wc_variations_image_update(!1),e.data("wcpa_product_image",!1),e.find(".variations select").trigger("change"))}function wcpa_remove_file(e){!0===e.data("details").required&&e.attr("required","required");var a=e.parents(".wcpa_file_outer");$preview=e.parents(".wcpa_form_item").find(".wcpa_upload_preview"),$preview.length&&$preview.html(""),$("~ .wcpa_progress",a).hide().css("width",0),$("~ .wcpa_file_hidden",a).val(""),e.parent().removeClass("wcpa_uploaded"),e.val(""),e.trigger("change"),a.find(".wcpa_file_name").removeClass("wcpa_file_error").html(""),iterate(e.parents(".wcpa_form_outer"))}function wcpa_upload_file(e){var a,t=e.prop("files"),i=!1,r=e.parents(".wcpa_file_outer");if(e.hasClass("wcpa_multiple")?i=!0:a=t[0],void 0!==a||i){if("object"==typeof e.data("wcpa_ajx_upload")&&e.data("wcpa_ajx_upload").abort(),$("[id="+e.attr("id")+"]").length>1){var p=$("[id="+e.attr("id")+"]:visible");p.length&&(e=p)}var n="";if(i){if(!t.length)return void r.find(".wcpa_file_name").removeClass("wcpa_file_error").html(n);$.each(t,((e,a)=>{n+=a.name+", "})),n=n.substring(0,n.length-2)}else{var c=e.val().match(/([^\/\\]+)$/);n=c[1]}if(r.find(".wcpa_file_name").removeClass("wcpa_file_error").html(n),$preview=e.parents(".wcpa_form_item").find(".wcpa_upload_preview"),$preview.length)if(i)t.length&&($preview.html(""),$.each(t,((e,a)=>{var t=new FileReader,i=a.name.split("."),r=i[i.length-1];["jpg","jpeg","png","gif","svg"].indexOf(r.toLowerCase())>-1&&(t.onload=function(a){$preview.hasClass("wcpa_no_preview_multiple")?$preview.append("<div class='wcpa_preview_block' id='wcpa_ajax_file_upload_preview_block_"+e+"'><div class='wcpa_progress' style='width:0;display:block;'></div></div>"):$preview.append("<div class='wcpa_preview_block' id='wcpa_ajax_file_upload_preview_block_"+e+"'><div class='wcpa_progress' style='width:0;display:block;'></div><img src='"+a.target.result+"' /></div>")},t.readAsDataURL(a))})));else if(a){var l=new FileReader,s=a.name.split("."),o=s[s.length-1];["jpg","jpeg","png","gif","svg"].indexOf(o.toLowerCase())>-1?(l.onload=function(e){$preview.html($("<img />").attr("src",e.target.result))},l.readAsDataURL(a)):$preview.html("")}if(e.is(".wcpa_ajax_upload")){var _;if(i){if(t.length){var d=[],u=!1;$.each(t,((a,i)=>{var p=new FormData,n=e.data("details");p.append("wcpa_file_details",JSON.stringify(n)),p.append("action","wcpa_ajax_upload"),!0===n.required&&e.attr("required","required"),p.append("wcpa_file",i),_=$.ajax({type:"POST",url:wcpa_global_vars.ajax_url,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);$("#wcpa_ajax_file_upload_preview_block_"+a+" .wcpa_progress").css("width",t+"%")}}),!1),e},beforeSend:function(){u||(e.parents(".wcpa_form_item").addClass("wcpa_uploading"),e.parent().removeClass("wcpa_uploaded"),$("~ .wcpa_file_hidden",r).val(""),e.parents("form").find("button[name=add-to-cart]").addClass("wcpa_disable_cart"),e.prop("disabled",!0)),$("~ .wcpa_remove_file",r).hide(),$("#wcpa_ajax_file_upload_preview_block_"+a+" .wcpa_progress").show().css("width",0);var t=parseInt(e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(t)?t=1:t++,e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",t),d[a]="true",u=!0},success:function(p){var n=$("~ .wcpa_file_hidden",r).val(),c=p.status?p.file.file+"||"+p.file.file_name:null,l=[];(l=n?JSON.parse(n):[])[a]=c;var s=JSON.stringify(l);if($("~ .wcpa_file_hidden",r).val(s).trigger("change"),!0===p.status)$("#wcpa_ajax_file_upload_preview_block_"+a+" .wcpa_progress").show().css("width","100%"),$("#wcpa_ajax_file_upload_preview_block_"+a+" .wcpa_progress").show();else{$("#wcpa_ajax_file_upload_preview_block_"+a).html('<div class="wcpa_file_error">'+i.name+" "+wcpa_global_vars.strings.ajax_upload_error+", "+p.message+"</div>");var o="",_=r.find(".wcpa_file_name").html();t.length&&($.each(t,((e,a)=>{a.name!==i.name&&-1!=_.indexOf(a.name)&&(o+=a.name+", ")})),o=o.substring(0,o.length-2)),r.find(".wcpa_file_name").html(o)}d[a]="false",-1===$.inArray("true",d)?(u=!1,$("~ .wcpa_remove_file",r).show(),e.parents(".wcpa_form_item").removeClass("wcpa_uploading"),e.val(""),e.parents("form").find("button[name=add-to-cart]").removeClass("wcpa_disable_cart"),!0===p.status&&(e.parent().addClass("wcpa_uploaded"),e.removeAttr("required")),e.prop("disabled",!1)):$("~ .wcpa_remove_file",r).hide();var f=parseInt(e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(f)||1===f?f=0:f--,e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",f)},error:function(p,n,c){$("#wcpa_ajax_file_upload_preview_block_"+a+" .wcpa_progress").show().css("width",0);var l=parseInt(e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(l)||1===l?l=0:l--,e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",l),"abort"!==c&&(e.val(""),$("#wcpa_ajax_file_upload_preview_block_"+a).html('<div class="wcpa_file_error">'+i.name+" "+ +wcpa_global_vars.strings.ajax_upload_error+"</div>")),d[a]="false",-1===$.inArray("true",d)&&(e.parents(".wcpa_form_item").removeClass("wcpa_uploading"),e.parents("form").find("button[name=add-to-cart]").removeClass("wcpa_disable_cart"));var s="";t.length&&($.each(t,((e,a)=>{a.name!==i.name&&(s+=a.name+", ")})),s=s.substring(0,s.length-2)),r.find(".wcpa_file_name").html(s)},async:!0,data:p,dataType:"json",cache:!1,contentType:!1,processData:!1}),iterate(e.parents(".wcpa_form_outer"))}))}}else{var f=new FormData,m=e.data("details");f.append("wcpa_file_details",JSON.stringify(m)),f.append("action","wcpa_ajax_upload"),!0===m.required&&e.attr("required","required"),f.append("wcpa_file",a),_=$.ajax({type:"POST",url:wcpa_global_vars.ajax_url,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var a=Math.round(100*e.loaded/e.total);$("~ .wcpa_progress",r).css("width",a+"%")}}),!1),e},beforeSend:function(){e.parents(".wcpa_form_item").addClass("wcpa_uploading"),e.parent().removeClass("wcpa_uploaded"),$("~ .wcpa_progress",r).show().css("width",0),$("~ .wcpa_file_hidden",r).val(""),e.parents("form").find("button[name=add-to-cart]").addClass("wcpa_disable_cart");var a=parseInt(e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(a)?a=1:a++,e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",a)},success:function(a){$("~ .wcpa_progress",r).show().css("width",100),e.parents(".wcpa_form_item").removeClass("wcpa_uploading"),$("~ .wcpa_progress",r).show(),e.val("");var t=parseInt(e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(t)||1===t?(t=0,e.parents("form").find("button[name=add-to-cart]").removeClass("wcpa_disable_cart")):t--,e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",t),!0===a.status?(e.removeAttr("required"),$("~ .wcpa_progress",r).css("width","100%"),$("~ .wcpa_file_hidden",r).val(a.file.file+"||"+a.file.file_name).trigger("change"),e.parent().addClass("wcpa_uploaded")):($("~ .wcpa_progress",r).css("width",0),r.find(".wcpa_file_name").addClass("wcpa_file_error").html(a.message))},error:function(a,t,i){$("~ .wcpa_progress",r).show().css("width",0);var p=parseInt(e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(p)||1===p?(p=0,e.parents("form").find("button[name=add-to-cart]").removeClass("wcpa_disable_cart")):p--,e.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",p),"abort"!==i&&(e.val(""),r.find(".wcpa_file_name").addClass("wcpa_file_error").html(wcpa_global_vars.strings.ajax_upload_error)),e.parents(".wcpa_form_item").removeClass("wcpa_uploading")},async:!0,data:f,dataType:"json",cache:!1,contentType:!1,processData:!1}),iterate(e.parents(".wcpa_form_outer"))}e.data("wcpa_ajx_upload",_)}}else r.find(".wcpa_file_name").removeClass("wcpa_file_error").html("")}$.fn.wcpa_serializeArrayAll=function(){var e=/\r?\n/g,a=this.map((function(){return this.elements?jQuery.makeArray(this.elements):this})).map((function(a,t){var i=jQuery(this).val();return null==i?null==i:"checkbox"!=this.type&&"radio"!==this.type?"select-multiple"==this.type?jQuery.map(i,((a,t)=>({name:this.name.replace("[]",`[${t}]`),value:a.replace(e,"\r\n")}))):jQuery.isArray(i)?jQuery.map(i,(function(a,i){return{name:t.name,value:a.replace(e,"\r\n")}})):{name:t.name,value:i.replace(e,"\r\n")}:!0===this.checked?{name:this.name,value:this.value}:void 0})).get();return Object.values(a.reduce(((e,a)=>{var t=a.name,i=a.value,r=e[t]?e[t].value:"";return e[t]={name:t,value:""===i&&""!==r?r:i},e}),{}))};var wcpa_drag_upload_flag=!1;function wcpa_manageUploadFile(e,a){if(multiple=!1,e.parent().find("input.wcpa_multiple").length>0&&(multiple=!0),multiple){var t=new FormData;a&&$.each(a,((a,i)=>{t.append("wcpa_file",i),t.append("wcpa_drag_drop","true");var r=e.parent().data("details");t.append("wcpa_file_details",JSON.stringify(r)),t.append("action","wcpa_ajax_upload"),wcpa_uploadFile(t,e.parent(),multiple)}))}else{t=new FormData;if(a[0]){t.append("wcpa_file",a[0]),t.append("wcpa_drag_drop","true");var i=e.parent().data("details");t.append("wcpa_file_details",JSON.stringify(i)),t.append("action","wcpa_ajax_upload"),wcpa_uploadFile(t,e.parent(),multiple)}}}function wcpa_uploadFile(e,a,t=!1){var i=0,r=!1;wcpa_drag_upload_flag&&!t||(r=!0),r&&$.ajax({type:"POST",url:wcpa_global_vars.ajax_url,xhr:function(){var e=$.ajaxSettings.xhr();return i=a.find("div.thumbnail:first").data("position"),e.upload&&e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);a.find("#thumbnail_"+i+" .wcpa_wcpa_file_upload_progress_active").css("width",t+"%")}}),!1),e},beforeSend:function(){wcpa_addThumbnailSkeleton(a,t),wcpa_drag_upload_flag=!0,a.parents("form").find("button[name=add-to-cart]").addClass("wcpa_disable_cart");var e=parseInt(a.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(e)?e=1:e++,a.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",e)},success:function(e){wcpa_drag_upload_flag=!1;var r=parseInt(a.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(r)||1===r?(r=0,a.parents("form").find("button[name=add-to-cart]").removeClass("wcpa_disable_cart")):r--,a.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",r),!0===e.status?(wcpa_addThumbnailImage(e,a,i,t),a.find("#thumbnail_"+i+" .wcpa_file_upload_progress").remove()):wcpa_AjaxUploadError(a,i,e.message,t)},error:function(e,r,p){var n=parseInt(a.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count"));isNaN(n)||1===n?(n=0,a.parents("form").find("button[name=add-to-cart]").removeClass("wcpa_disable_cart")):n--,a.parents("form").find("button[name=add-to-cart]").data("wcpa-upload-count",n),"abort"!==p&&wcpa_AjaxUploadError(a,i,"",t)},async:!0,data:e,dataType:"json",cache:!1,contentType:!1,processData:!1})}function wcpa_addThumbnailSkeleton(e,a){var t=e.find(".wcpa-upload-area"),i=e.find("div.thumbnail:first").data("position")?e.find("div.thumbnail:first").data("position"):0,r=Number(i),p='<div class="wcpa_file_upload_progress"><div class="wcpa_file_upload_progress_inner">';p+='<div class="wcpa_wcpa_file_upload_progress_bar">',p+='<span class="wcpa_wcpa_file_upload_progress_active"></span></div>',e.hasClass("wcpa_drop_preview")&&(p+="<div class='wcpa_wcpa_file_upload_progress_text'>"+wcpa_global_vars.strings.drag_drop_ajax_file_upload.uploading+"</div>"),p+="</div></div>",a||0===r?(r+=1,t.prepend('<div id="thumbnail_'+r+'" data-position="'+r+'" class="thumbnail"></div>'),t.find("#thumbnail_"+r).append(p)):(t.find("#thumbnail_"+r).html(""),t.find("#thumbnail_"+r).append(p)),e.find(".upload-area-title").hide(),e.find(".upload-area-title-thumb-style").show()}function wcpa_addThumbnailImage(e,a,t,i){var r=e.file.file+"||"+e.file.file_name;if(r){if(i){var p=a.find(".wcpa_drag_file_input").val(),n=p?JSON.parse(p):[];n[t-1]=r,a.find(".wcpa_drag_file_input").val(JSON.stringify(n)).trigger("change")}else a.find(".wcpa_drag_file_input").val(r).trigger("change");var c=Number(t),l=e.file.file_name,s=e.file.url;a.find("#thumbnail_"+c).empty(),a.find("#thumbnail_"+c).attr("data-fileData",r),a.find("#thumbnail_"+c).append('<span class="wcpa_remove_image"></span>');var o=l.split("."),_=o[o.length-1];a.hasClass("wcpa_drop_preview")&&(["jpg","jpeg","png","gif","svg"].indexOf(_.toLowerCase())>-1?a.find("#thumbnail_"+c).append('<img src="'+s+'" alt="'+l+'"/>'):a.find("#thumbnail_"+c).append('<div class="wcpa_img_place_holder">'+_.toUpperCase()+"</div>")),a.find("#thumbnail_"+c).append('<div class="wcpa_file_details_content_title">'+l+"</div>"),a.find(".wcpa-upload-message").html(e.message),iterate(a.parents(".wcpa_form_outer"))}}function wcpa_AjaxUploadError(e,a,t="",i=!1){var r=e.find(".wcpa_drag_file_input").val();if(i){var p=r?JSON.parse(r):[];p[a-1]=null,e.find(".wcpa_drag_file_input").val(JSON.stringify(p)).trigger("change")}else e.find(".wcpa_drag_file_input").val("").trigger("change");var n=Number(a),c=t||wcpa_global_vars.strings.ajax_upload_error;e.find("#thumbnail_"+n).remove(),e.find(".wcpa-upload-message").html(c),0==e.find(".thumbnail").length&&(e.find(".upload-area-title").show(),e.find(".upload-area-title-thumb-style").hide(),e.find(".upload-area-subtitle").show(),e.find(".wcpa_drop_text").hide())}function regExpFromString(e,a){var t=e.replace(/.*\/([gimuy]*)$/,"$1");t===e&&(t="");var i="/"==e.charAt(0)?e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1"):e;try{return""==t&&"/"!==e.charAt(0)&&(t=a),new RegExp(i,t)}catch(e){return null}}function compareRegExpWithString(e="",a=""){return new RegExp("^"+a+"$").test(e)}$(document).on("dragover","html",(function(e){$("html").find(".wcpa_drag_drop").length&&(e.preventDefault(),e.stopPropagation(),$(".wcpa_drag_drop .wcpa-upload-area .upload-area-title").find(".upload-area-subtitle").show(),$(".wcpa_drag_drop .wcpa-upload-area .upload-area-title").find(".wcpa_drop_text").hide())})),$(document).on("drop","html",(function(e){$("html").find(".wcpa_drag_drop").length&&(e.preventDefault(),e.stopPropagation())})),$(document).on("dragenter dragover",".wcpa_drag_drop .wcpa-upload-area",(function(e){e.stopPropagation(),e.preventDefault(),$(this).find(".upload-area-subtitle").hide(),$(this).find(".wcpa_drop_text").show()})),$(document).on("ondragleave",".wcpa_drag_drop .wcpa-upload-area",(function(e){e.stopPropagation(),e.preventDefault(),$(this).find(".upload-area-subtitle").show(),$(this).find(".wcpa_drop_text").hide()})),$(".wcpa_drag_drop .upload-area-title .upload-area-subtitle span, .wcpa_drag_drop .upload-area-title-thumb-inner span").on("click",(function(e){e.preventDefault(),e.stopPropagation();var a="";$(this).parents(".wcpa_drag_drop").find("input.wcpa_multiple").length>0&&(a="multiple"),$(this).parents(".wcpa_drag_drop").find("input.wcpa_dynamic_file_uploader").length<=0&&$(this).parents(".wcpa_drag_drop").append('<input type="file" class="wcpa_dynamic_file_uploader" '+a+">"),$(this).parents(".wcpa_drag_drop").find("input.wcpa_dynamic_file_uploader").click()})),$(document).on("change onblur",".wcpa_drag_drop input.wcpa_dynamic_file_uploader",(function(e){var a=e.target.files;e.target.value.length&&wcpa_manageUploadFile($(this),a),$(this).remove()})),$(document).on("drop",".wcpa_drag_drop .wcpa-upload-area",(function(e){e.stopPropagation(),e.preventDefault(),$(this).find(".upload-area-subtitle").show(),$(this).find(".wcpa_drop_text").hide();var a=e.originalEvent.dataTransfer.files;wcpa_manageUploadFile($(this),a)})),$(document).on("click",".wcpa-upload-area .wcpa_remove_image",(function(e){e.preventDefault(),e.stopPropagation();var a=!1;if($(this).parents(".wcpa_drag_drop").find("input.wcpa_multiple").length>0&&(a=!0),a){var t=$(this).parent().data("position"),i=Number(t),r=$(this).parents(".wcpa_drag_drop").find("input.wcpa_drag_file_input").val(),p=r?JSON.parse(r):[];p[i-1]=null,$(this).parents(".wcpa_drag_drop").find("input.wcpa_drag_file_input").val(JSON.stringify(p)).trigger("change")}else $(this).parents(".wcpa_drag_drop").find("input.wcpa_drag_file_input").val("").trigger("change");$drop_wrap=$(this).parents(".wcpa-upload-area"),$(this).parent().remove(),0==$drop_wrap.find(".thumbnail").length&&($drop_wrap.find(".upload-area-title").show(),$drop_wrap.find(".upload-area-title-thumb-style").hide(),$drop_wrap.find(".upload-area-subtitle").show(),$drop_wrap.find(".wcpa_drop_text").hide()),iterate($drop_wrap.parents(".wcpa_form_outer"))}));var total_price=0,total_fee=0,wcpa_price=function(e){return wcpa_number_format(e,wcpa_global_vars.wc_price_decimals,wcpa_global_vars.wc_decimal_sep,wcpa_global_vars.wc_thousand_sep)};function wcpa_number_format(e,a,t,i){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var r=isFinite(+e)?+e:0,p=isFinite(+a)?Math.abs(a):0,n=void 0===i?",":i,c=void 0===t?".":t,l="";return l=(p?function(e,a){var t=Math.pow(10,a);return""+Math.round(e*t)/t}(r,p):""+Math.round(r)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,n)),(l[1]||"").length<p&&(l[1]=l[1]||"",l[1]+=new Array(p-l[1].length+1).join("0")),l.join(c)}function exc_Label(ele,$form_outer){if(void 0===$form_outer&&($form_outer=!1),"string"==typeof ele)var $element=$("#"+ele,$form_outer);else var $element=ele;var product_data=$form_outer.data("product");if(0==$element.length)return!1;var quantity=parseInt($form_outer.parents("form").find("input[name=quantity]").val());if($element.find(".wcpa_paragraph_block").length){var $label=$element.find(".wcpa_paragraph_block").data("label");if(void 0===$label||void 0===$label.label)return!1;if($label.label.match(/\#\=(.+?)\=\#/)){var matches=$label.label.match(/\#\=(.+?)\=\#/g),out=$label.label;for(var i in matches){var mat=matches[i].match(/\#\=(.+?)\=\#/);if(mat[1]){var formula=calculate_price("custom",1,mat[1],quantity,product_data,$element,!1,!0);if(""===formula||"0"===formula)out=out.replace(mat[0],"");else try{var res=eval(formula);isNaN(res)||res%1==0||(res=wcpa_price(res)),out=out.replace(mat[0],res)}catch(e){out=out.replace(mat[0],formula)}}}$element.find(".wcpa_paragraph_block").html(out)}}if($element.find(".wcpa_statictext_block").length){var $static_value=$element.find(".wcpa_statictext_block").data("value");if(void 0===$static_value||void 0===$static_value.value)return!1;if($static_value.value.match(/\#\=(.+?)\=\#/)){var matches=$static_value.value.match(/\#\=(.+?)\=\#/g),out=$static_value.value;for(var i in matches){var mat=matches[i].match(/\#\=(.+?)\=\#/);if(mat[1]){var formula=calculate_price("custom",1,mat[1],quantity,product_data,$element,!1,!0);if(""===formula||"0"===formula)out=out.replace(mat[0],"");else try{var res=eval(formula);isNaN(res)||res%1==0||(res=wcpa_price(res)),out=out.replace(mat[0],res)}catch(e){out=out.replace(mat[0],formula)}}}$element.find(".wcpa_statictext_block").html(out)}}}function exc_relations(ele_id,$form_outer){void 0===$form_outer&&($form_outer=!1);var $element=$("#"+ele_id,$form_outer),product_data=$form_outer.data("product");if(0==$element.length)return!1;var $relation=$element.data("rules");if(!$relation)return!1;var $rules=$relation.rules;$evel_str="",$rules.forEach((function(e){$evel_str+="(",e.rules.forEach((function(e){$evel_str+="(",eval_relation(e.rules,$element,product_data,$form_outer)?$evel_str+=" true ":$evel_str+=" false ",$evel_str+=") "+(!1!==e.operator?e.operator:"")+" "})),e.length>0&&($evel_str=$evel_str.match(/\(.*\)/g)[0]+" "),$evel_str+=") "+(!1!==e.operator?e.operator:"")+" "})),$rules.length>0&&($evel_str=$evel_str.match(/\(.*\)/g)[0]);var result=!1;try{result=eval($evel_str.replace(/or/gi,"||").replace(/and/gi,"&&"))}catch(e){return!1}if(result)if("show"==$relation.action){if(enable_fields($element),$element.is(":visible"))return!0;$element.show(0,(function(){$element.trigger("element_cl_updated")})).addClass("wcpa_cl_visible")}else{if(disable_fields($element),$element.removeClass("wcpa_cl_visible"),!$element.is(":visible"))return!0;$element.hide(0,(function(){$element.trigger("element_cl_updated")}))}else if("show"==$relation.action){if(disable_fields($element),$element.removeClass("wcpa_cl_visible"),!$element.is(":visible"))return!0;$element.hide(0,(function(){$element.trigger("element_cl_updated")}))}else{if(enable_fields($element),$element.is(":visible"))return!0;$element.show(0,(function(){$element.trigger("element_cl_updated")})).addClass("wcpa_cl_visible")}var related=$element.data("related");null!=related&&related.forEach((function(e){exc_relations(e,$form_outer)})),$form_outer.trigger("wcpa.cl_updated"),setTimeout((function(){iterate($element.parents(".wcpa_form_outer"))}),0)}function disable_fields(e){e.find("select,input,file,textarea").attr("disabled","disabled")}function enable_fields(e){e.find("select,input,file,textarea").removeAttr("disabled"),e.is(".wcpa_type_color")&&$(".wcpa_colorpicker",e).spectrum({preferredFormat:"hex",showInput:!0,allowEmpty:!0})}function eval_relation(e,a,t,i){if("quantity"===e.cl_field)var r=a.parents("form").find("input[name=quantity]");else if("attribute"===e.cl_field){var p=void 0!==t.product_attributes[e.cl_relation]?t.product_attributes[e.cl_relation].value:[];if(t.is_variable)if($dropdown=a.parents("form.variations_form").find(".variations select[name='attribute_"+e.cl_relation+"']"),$dropdown&&$dropdown.length>0)r=(r=a.parents("form.variations_form").find(".variations select[name='attribute_"+e.cl_relation+"']").val())?[r]:[];else r=p;else r=p}else if("stock_status"===e.cl_field){(r=new Array).push(t.stock_status)}else if("stock_quantity"===e.cl_field){(r=new Array).push(t.stock_quantity)}else if("custom_field"===e.cl_field){(r=new Array).push(t.product_cfs)}else if("product_ids"===e.cl_field){(r=new Array).push(t.product_id)}else r=$("#"+e.cl_field,i);if(!r.length)return!1;if("0"===e.cl_relation)return!1;var n=Array();if($.inArray(e.cl_field,["stock_status","stock_quantity","custom_field","product_ids","attribute"])<0&&(r.is(":visible")||$.inArray(r.data("type"),["hidden"])>=0||"quantity"==e.cl_field))if($.inArray(r.data("type"),["text","color","hidden"])>=0)r.find("input").val()&&n.push(r.find("input").val().toLowerCase().trim());else if($.inArray(r.data("type"),["file"])>=0){var c=e.cl_field;if(c=c.replace("wcpa-","#"),r.find("input[type=hidden]").length){var l="",s=r.find("input[type=hidden]").val();s?$(c).hasClass("wcpa_multiple")?s&&(files=JSON.parse(s),files&&$.each(files,((e,a)=>{a&&2===a.split("||").length&&n.push(a.split("||")[1].toLowerCase())}))):2===s.split("||").length&&n.push(s.split("||")[1].toLowerCase()):r.find(".wcpa_drag_drop").length<=0&&r.find(c)[0].files.length&&(l=r.find(c)[0].files,$.each(l,((e,a)=>{n.push(a.name.toLowerCase())})))}else r.find(c)[0].files.length&&(l=r.find(c)[0].files,$.each(l,((e,a)=>{n.push(a.name.toLowerCase())})))}else if($.inArray(r.data("type"),["number"])>=0)r.find("input").val()&&n.push(parseFloat(r.find("input").val().toLowerCase().trim()));else if("quantity"===e.cl_field)r.val()&&n.push(parseFloat(r.val().toLowerCase().trim()));else if($.inArray(r.data("type"),["textarea"])>=0)r.find("textarea").val()&&n.push(r.find("textarea").val().toLowerCase().trim());else if($.inArray(r.data("type"),["checkbox-group","radio-group"])>=0)n=r.find("input:checked").map((function(){return $(this).hasClass("wcpa_other")?$.inArray(e.cl_relation,["contains","not_contains","starts_with","ends_with"])>=0?$(this).val().replace("WCPAOTH ","").toLowerCase():"other":$(this).val().toLowerCase()})).get();else if($.inArray(r.data("type"),["select"])>=0)r.find("select").val()&&r.find("select").val().constructor===Array?n=r.find("select").val().map((function(e){return e.toLowerCase()})):r.find("select").val()&&n.push(r.find("select").val().toLowerCase());else if($.inArray(r.data("type"),["date","datetime-local"])>=0){if(r.find("input").val())if($.inArray(e.cl_relation,["contains","not_contains","starts_with","ends_with"])>=0)n.push(r.find("input").val().toLowerCase());else"function"==typeof(o=wcpa_get_date_obj(r.find("input").val(),"wp")).getTime&&n.push(o.getTime())}else if($.inArray(r.data("type"),["time"])>=0){if(r.find("input").val())if($.inArray(e.cl_relation,["contains","not_contains","starts_with","ends_with"])>=0)n.push(r.find("input").val().toLowerCase());else{var o=new Date("1/1/2018 "+r.find("input").val());n.push(o.getTime())}}else $.inArray(r.data("type"),["image-group","color-group"])>=0?n=r.find("input:checked").map((function(){return $(this).hasClass("wcpa_other")?$.inArray(e.cl_relation,["contains","not_contains","starts_with","ends_with"])>=0?$(this).val().replace("WCPAOTH ","").toLowerCase():"other":$(this).val().toLowerCase()})).get():$.inArray(r.data("type"),["productGroup"])>=0&&(n=r.find("input:checked").map((function(){return $(this).val().toLowerCase()})).get());var _=!1;if("attribute"===e.cl_field)return!(!r||!r.length)&&(n=r.map((function(e){return e.toLowerCase()})),_=e.cl_val.value?e.cl_val.value:e.cl_val,$.inArray(_,n)>=0);if("stock_status"===e.cl_field)n.push(t.stock_status);else if("stock_quantity"===e.cl_field)n.push(t.stock_quantity);else if("product_ids"===e.cl_field)n.push(t.product_id);else if("custom_field"===e.cl_field)return void 0!==t.product_cfs["wcpa_pcf_"+e.cl_relation]&&(n.push(t.product_cfs["wcpa_pcf_"+e.cl_relation].toLowerCase()),_=e.cl_val.value?e.cl_val.value:e.cl_val,$.inArray(_,n)>=0);if(0==n.length)switch(e.cl_relation){case"is_empty":return 0===n.length||""===n[0]||null===n[0];case"is_not_empty":return 0!==n.length&&""!==n[0]&&null!==n[0];default:return!1}if(e.cl_val&&"stock_status"===e.cl_field)_=e.cl_val.value?e.cl_val.value:e.cl_val;else if(e.cl_val&&"product_ids"===e.cl_field)_=(_=(e.cl_val.value?e.cl_val.value:e.cl_val).split(/[ ,]+/)).map((function(e){return parseInt(e,10)}));else if(e.cl_val&&"quantity"===e.cl_field||"stock_quantity"===e.cl_field)_=parseInt(e.cl_val.value?e.cl_val.value:e.cl_val);else if(e.cl_val&&"image-group"==r.data("type"))_=(e.cl_val.i?e.cl_val.i:e.cl_val).toLowerCase();else if(e.cl_val&&"productGroup"==r.data("type"))_=(e.cl_val.i?e.cl_val.i:e.cl_val).toLowerCase();else if(!e.cl_val||"date"!=r.data("type")&&"datetime-local"!=r.data("type"))if(e.cl_val&&"time"==r.data("type")){if($.inArray(e.cl_relation,["contains","not_contains","starts_with","ends_with"])>=0)_=e.cl_val.toLowerCase();else _=new Date("1/1/2018 "+e.cl_val).getTime()}else e.cl_val&&"number"==r.data("type")?_=parseFloat(e.cl_val.value?e.cl_val.value:e.cl_val):e.cl_val&&(_=(e.cl_val.value?e.cl_val.value:e.cl_val).toLowerCase());else{if($.inArray(e.cl_relation,["contains","not_contains","starts_with","ends_with"])>=0)_=e.cl_val.toLowerCase();else _=wcpa_get_date_obj(e.cl_val).getTime()}switch(e.cl_relation){case"is":case"date_is":case"time_is":return $.inArray(_,n)>=0;case"is_not":return!($.inArray(_,n)>=0);case"is_in":return!!Array.isArray(_)&&_.filter((function(e){return $.inArray(e,n)>=0})).length>0;case"is_not_in":return!!Array.isArray(_)&&!(_.filter((function(e){return $.inArray(e,n)>=0})).length>0);case"is_empty":return 0===n.length||""===n[0]||null===n[0];case"is_not_empty":return 0!==n.length&&""!==n[0]&&null!==n[0];case"is_greater":for(var d=0;d<n.length;d++)if(parseFloat(n[d])>parseFloat(_))return!0;return!1;case"is_lessthan":for(d=0;d<n.length;d++)if(parseFloat(n[d])>=parseFloat(_))return!1;return!0;case"is_greater_or_eqaul":for(d=0;d<n.length;d++)if(parseFloat(n[d])>=parseFloat(_))return!0;return!1;case"is_lessthan_or_eqal":for(d=0;d<n.length;d++)if(parseFloat(n[d])>parseFloat(_))return!1;return!0;case"contains":for(d=0;d<n.length;d++)if(-1!==n[d].indexOf(_))return!0;return!1;case"not_contains":for(d=0;d<n.length;d++)if(-1!==n[d].indexOf(_))return!1;return!0;case"starts_with":for(d=0;d<n.length;d++)if(n[d].startsWith(_))return!0;return!1;case"ends_with":for(d=0;d<n.length;d++)if(n[d].endsWith(_))return!0;return!1;case"date_is_before":case"time_is_before":for(d=0;d<n.length;d++)if(parseFloat(n[d])>=parseFloat(_))return!1;return!0;case"date_is_after":case"time_is_after":for(d=0;d<n.length;d++)if(parseFloat(n[d])>parseFloat(_))return!0;return!1}}function iterate(e,a){if(void 0===a&&(a=!0),a&&$(".wcpa_form_item",e).data("wcpa_price",!1),e.data("wcpa_deps_counter",0),wcpa_may_update_quantity(e),total_price=0,total_fee=0,$(".wcpa_has_price",e).each((function(a,t){if(!wcpa_check_form_visibility($(this),$(this).parents(".wcpa_form_item")))return!0;$(this).is("select")?$(this).find("option").each((function(){wcpa_update_price($(this),e.data("product"))})):wcpa_update_price($(this),e.data("product"))})),e.data("wcpa_deps_counter")>0)iterate(e,!1);else{if($(".wcpa_has_price",e).length){var t=+e.data("product").wc_product_price,i=+e.data("product").wc_product_regular_price,r=+e.data("product").con_unit,p=e.data("rules"),n=parseInt(e.parents("form").find("input[name=quantity]").val());if(n||(n=1),p&&!0===p.pric_overide_base_price)var c=Math.max(t*r,total_price);else if(p&&!0===p.pric_overide_base_price_if_gt_zero&&total_price>0)c=total_price;else if(p&&!0===p.pric_overide_base_price_fully)c=total_price;else c=t*r+total_price;wcpa_global_vars.change_price_as_quantity?(e.parent().find(".wcpa_price_summary").find(".wcpa_options_total .price_value").text(wcpa_price((total_price-total_fee)*n+total_fee)),e.parent().find(".wcpa_price_summary").find(".wcpa_product_total .price_value").text(wcpa_price(t*n*r)),i!=t&&e.parent().find(".wcpa_price_summary").find(".wcpa_product_total .wcpa_price_strike").text(wcpa_price(i*n*r)),e.parent().find(".wcpa_price_summary").find(".wcpa_total .price_value").text(wcpa_price((c-total_fee)*n+total_fee))):(e.parent().find(".wcpa_price_summary").find(".wcpa_options_total .price_value").text(wcpa_price(total_price)),e.parent().find(".wcpa_price_summary").find(".wcpa_product_total .price_value").text(wcpa_price(t*r)),e.parent().find(".wcpa_price_summary").find(".wcpa_product_total .wcpa_price_strike").text(wcpa_price(t*r)),i!=t&&e.parent().find(".wcpa_price_summary").find(".wcpa_product_total .wcpa_price_strike").text(wcpa_price(i*r)),e.parent().find(".wcpa_price_summary").find(".wcpa_total .price_value").text(wcpa_price(c<0?0:c))),e.data("wcpa",{fee:total_fee,price:{options:total_price,product:t,total:c}}),e.trigger("wcpa.price_updated")}if(wcpa_may_update_quantity(e),$(".wcpa_has_label_formula, .wcpa_has_value_formula",e).each((function(a,t){if(!($(this).parent().is(":visible")||$(this).parents(".wcpa_form_item").is(".wcpa_visible")||$(this).parents(".wcpa_form_item").is(".wcpa_visible_parent")))return!0;exc_Label($(this).parents(".wcpa_form_item"),e)})),$(".wcpa_update_product_image",e).length){var l=!1;$($(".wcpa_update_product_image",e).get().reverse()).each((function(){if($(this).is("select")){if($ele=$(this).find("option:selected"),!$ele)return}else{if(!$(this).is(":checked"))return;$ele=$(this)}if($(this).parents(".wcpa_form_item").is(":visible")||$(this).parents(".wcpa_form_item").hasClass("wcpa_cl_visible")){var a=$ele.data("image");if(a&&a.src)return wcpa_product_image_update(e.parents("form"),$ele),l=!0,!1}})),l||wcpa_product_image_update(e.parents("form"),!1)}}}function wcpa_may_update_quantity(e){var a=e.data("rules");if(a.bind_quantity){var t=$("input[name=quantity]",e.parents("form"));if(t.length){t.attr("readonly","readonly");var i=calculate_price("custom",1,a.quantity_bind_formula,1,e,t),r=t.val();i>0?t.val(i):t.val(1),r!=t.val()&&t.trigger("change")}}}function wcpa_update_price(e,a){var t=e.data("price"),i=parseInt(e.parents("form").find("input[name=quantity]").val()),r=0,p=0;if(!t)t=e.find(":selected").data("price");t||(t={type:!1,priceoptions:!1,value:!1,pricingType:!1,taxpu:1,con_unit:1,is_show_price:!1});var n=e.val().trim();if($.inArray(t.type,["radio-group","checkbox-group","image-group","color-group","productGroup"])>=0&&!e.is(":checked")&&(n=!1),$.inArray(t.type,["select"])>=0&&!e.is(":selected")&&(n=!1),e.hasClass("wcpa_other")&&$.inArray(t.type,["radio-group","checkbox-group","image-group","color-group"])>=0&&e.is(":checked")&&(n=e.nextAll(".wcpa_other_val").val().trim()),$.inArray(t.type,["paragraph","header","statictext"])>=0&&(n=1),$.inArray(t.type,["file"])>=0&&(e.parents(".wcpa_form_item").find(".wcpa_file_hidden").length&&""==n&&""!==e.parents(".wcpa_form_item").find(".wcpa_file_hidden").val()&&(n=e.parents(".wcpa_form_item").find(".wcpa_file_hidden").val().split("||")[1]),e.parents(".wcpa_form_item").find(".wcpa_drag_file_input").length)){var c=e.parents(".wcpa_form_item").find(".wcpa_drag_file_input").val();if(""!==c)if(e.parents(".wcpa_form_item").find(".wcpa_drag_file_input.wcpa_multiple").length){var l=JSON.parse(c),s="";l&&$.each(l,((e,a)=>{a&&(s+=a.split("||")[1])})),n=""!=s&&s}else n=c.split("||")[1]}r=calculate_price(t.pricingType,n,t.value,i,a,e,t),"custom"!=t.pricingType&&"percentage"!=t.pricingType||t.taxpu&&(r*=t.taxpu),t.con_unit&&(r*=t.con_unit),void 0!==t.is_show_price&&0!=t.is_show_price||(total_price+=r);var o=1;void 0!==wcpa_global_vars.show_field_price_x_quantity&&wcpa_global_vars.show_field_price_x_quantity&&(o=i),void 0!==t.is_fee&&!0===t.is_fee&&(total_fee+=r,o=1),e.data("elem_price",r),e.is("option")?(e.parent().find(":checked").each((function(){p+=$(this).data("elem_price")?$(this).data("elem_price"):0})),e.parents(".wcpa_form_item").data("wcpa_price",p/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(p*o))):"checkbox-group"==t.type?(e.parents(".checkbox-group").find("input:checked").each((function(){p+=$(this).data("elem_price")?$(this).data("elem_price"):0})),e.parents(".wcpa_form_item").data("wcpa_price",p/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(p*o))):"radio-group"==t.type?(e.parents(".radio-group ").find("input:checked").each((function(){p+=$(this).data("elem_price")?$(this).data("elem_price"):0})),e.parents(".wcpa_form_item").data("wcpa_price",p/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(p*o))):"image-group"==t.type?(e.parents(".image-group ").find("input:checked").each((function(){p+=$(this).data("elem_price")?$(this).data("elem_price"):0})),e.parents(".wcpa_form_item").data("wcpa_price",p/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(p*o))):"productGroup"==t.type?(e.parents(".wcpa_productGroup").find("input:checked").each((function(){p+=$(this).data("elem_price")?$(this).data("elem_price"):0})),e.parents(".wcpa_form_item").data("wcpa_price",p/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(p*o))):"color-group"==t.type?(e.parents(".color-group ").find("input:checked").each((function(){p+=$(this).data("elem_price")?$(this).data("elem_price"):0})),e.parents(".wcpa_form_item").data("wcpa_price",p/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(p*o))):e.parents(".wcpa_form_item").data("wcpa_price",r/(t.taxpu*t.con_unit)).find(".price_value").text(wcpa_price(r*o)),e.parents(".wcpa_form_item").trigger("wcpa.item_price_updated")}function calculate_price(pricingType,value,price,quantity,$product_data,$ele,element_data,isLabel){if(void 0===element_data)var element_data={};if(void 0===isLabel)var isLabel=!1;"custom"!==pricingType&&(null!==price&&!1!==price&&"string"==typeof price&&(price=parseFloat(price.replace(wcpa_global_vars.wc_decimal_sep,"."))),isNaN(price)&&(price=0));var elem_price=0;switch(pricingType){case"fixed":if(value)if($product_qty_ele=$ele.parents(".wcpa_productGroup_item").find("input[type=number]"),$product_qty_ele.length){var qty=parseInt($product_qty_ele.val());qty=qty||0===qty?qty:0,elem_price=+price*qty}else elem_price=+price;else elem_price=0;break;case"per_car":var value_filtered=value;if(void 0!==element_data.excl_chars_frm_length&&element_data.excl_chars_frm_length.length>0)if(void 0!==element_data.excl_chars_frm_length_is_regex&&element_data.excl_chars_frm_length_is_regex){var exclude_chars=element_data.excl_chars_frm_length,re=regExpFromString(exclude_chars,"gi");value_filtered=value_filtered.replace(re,"")}else{var exclude_chars=element_data.excl_chars_frm_length.replace(/\\s/g," ");exclude_chars=exclude_chars.split("").map((function(e){if(" "==e){var a=new RegExp("\\s","g");value_filtered=value_filtered.replace(a,"")}else if("."==e)value_filtered=value_filtered.replace(/\./,"");else{a=new RegExp(e,"g");value_filtered=value_filtered.replace(a,"")}return e}))}elem_price=value_filtered.length*price;break;case"multiply":elem_price=value?+price*(isNaN(value)?1:value):0,elem_price<0&&(elem_price=0);break;case"custom":if(!1!==value&&""!==value&&null!==value){if($ele_outer=$ele.parents(".wcpa_form_item"),"function"==typeof moment)var today={seconds:moment().unix()};else var today={seconds:wcpa_global_vars.today.seconds};var formula=price.replace(/{this.value}/g,value).replace(/{value}/g,value).replace(/{quantity}/g,quantity).replace(/{this.value.length}/g,value.length).replace(/{value.length}/g,value.length).replace(/{product_price}/g,$product_data.wc_product_price).replace(/{days}/g,date_data_from_field("days",$ele_outer)).replace(/{seconds}/g,date_data_from_field("seconds",$ele_outer)).replace(/{timestamp}/g,date_data_from_field("timestamp",$ele_outer)).replace(/{today.days}/g,wcpa_global_vars.today.days).replace(/{today.seconds}/g,today.seconds).replace(/{this.option_price}/g,element_data.option_price?element_data.option_price:0).replace(/{option_price}/g,element_data.option_price?element_data.option_price:0).replace(/{this.count}/g,get_data_from_field("count",$ele)).replace(/{count}/g,get_data_from_field("count",$ele));if(formula.match(/\{(\s)*?wcpa_pcf_([^}]*)}/)){var cf_matches=formula.match(/\{(\s)*?wcpa_pcf_([^}]*)}/g);for(var i in cf_matches){var mat=cf_matches[i].match(/\{(\s)*?([^}]*)}/);if(void 0!==mat[2]&&"string"==typeof mat[2]&&void 0!==$product_data.product_cfs[mat[2].trim()]){var myReg=new RegExp(mat[0]);formula=formula.replace(myReg,$product_data.product_cfs[mat[2].trim()])}else{var myReg=new RegExp(mat[0]);formula=formula.replace(myReg,0)}}}if(formula.match(/\{(\s)*?field\.([^}]*)}/)){var matches=formula.match(/\{(\s)*?field\.([^}]*)}/g);for(var i in matches){var mat=matches[i].match(/\{(\s)*?field\.([^}]*)}/);if(void 0!==mat[2]&&"string"==typeof mat[2]){var ele=mat[2].split(".");if(ele.length>1&&$.inArray(ele[1],["value","price","count","selected","days","seconds","timestamp"])>=0){var $ele=$("#"+ele[0]);if($ele.length){var val=0;if($ele.is(":visible")||"hidden"==$ele.data("type"))switch(ele[1]){case"price":if($ele.find(".wcpa_has_price").length){if(void 0===$ele.data("wcpa_price")||!1===$ele.data("wcpa_price")){elem_price=0;var wcpa_deps_counter=$ele.parents(".wcpa_form_outer").data("wcpa_deps_counter");return wcpa_deps_counter=void 0===wcpa_deps_counter?0:wcpa_deps_counter,wcpa_deps_counter+=1,$ele.parents(".wcpa_form_outer").data("wcpa_deps_counter",wcpa_deps_counter),elem_price}val=$ele.data("wcpa_price")}break;case"value":switch($ele.data("type")){case"select":val=$ele.find("select").val()?$ele.find("select").val():0;break;case"textarea":val=$ele.find("textarea").val()?$ele.find("textarea").val():0;break;case"productGroup":val=0;break;case"checkbox-group":case"radio-group":case"color-group":case"image-group":val=0,$ele.find("input:checked").length?1==$ele.find("input:checked").length?isNaN($ele.find("input:checked").val())?val=$ele.find("input:checked").val():val+=parseFloat($ele.find("input:checked").val()):$ele.find("input:checked").each((function(e){if(isNaN($(this).val())){if(0==e)return val=$(this).val(),!1}else val+=parseFloat($(this).val())})):val=0;break;default:val=$ele.find("input").val()?$ele.find("input").val():0}if(void 0!==ele[2]&&"length"===ele[2])val=val.length;break;case"count":switch($ele.data("type")){case"select":val=$ele.find("select").val()?1:0;break;case"textarea":val=$ele.find("textarea").val()?1:0;break;case"checkbox-group":case"radio-group":case"color-group":case"image-group":val=0,val=$ele.find("input:checked").length?1==$ele.find("input:checked").length?1:$ele.find("input:checked").length:0;break;case"productGroup":val=0;var inputType="radio";$ele.find(".wcpa_multiselect").length&&(inputType="checkbox"),$checked=$ele.find("input[type="+inputType+"]:checked"),$checked.length&&$.each($checked,((e,a)=>{var t=parseInt($(a).siblings("input[type=number]").val());t&&(val+=t)}));break;case"file":if($ele.find("input[type=hidden]").length){var inputSelector=ele[0];val=get_data_from_field("count",$(inputSelector.replace("wcpa-","#")))}else val=get_data_from_field("count",$ele.find("input[type=file]"));break;default:val=$ele.find("input").val()?1:0}break;case"selected":switch($ele.data("type")){case"select":val=$ele.find("select").val()?1:0;break;case"textarea":val=$ele.find("textarea").val()?1:0;break;case"checkbox-group":case"radio-group":case"color-group":case"image-group":val=0,val=$ele.find("input:checked").length?1==$ele.find("input:checked").length?1:$ele.find("input:checked").length:0;break;case"productGroup":val=0;var inputType="radio";$ele.find(".wcpa_multiselect").length&&(inputType="checkbox"),val=$ele.find("input[type="+inputType+"]:checked").length;break;case"file":if($ele.find("input[type=hidden]").length){var inputSelector=ele[0];val=get_data_from_field("selected_count",$(inputSelector.replace("wcpa-","#")))}else val=get_data_from_field("selected_count",$ele.find("input[type=file]"));break;default:val=$ele.find("input").val()?1:0}break;case"days":case"seconds":case"timestamp":switch($ele.data("type")){case"date":case"datetime-local":val=date_data_from_field(ele[1],$ele);break;default:val=0}}}else var val=0;var myReg=new RegExp(mat[0]);formula=isNaN(val)&&!isLabel?formula.replace(myReg,"'"+val+"'"):formula.replace(myReg,val)}}}}if(isLabel)return formula;try{if($product_qty_ele=$ele.parents(".wcpa_productGroup_item").find("input[type=number]"),$product_qty_ele.length){var qty=parseInt($product_qty_ele.val());qty=qty||0===qty?qty:0,elem_price=eval(formula)*qty}else elem_price=eval(formula)}catch(e){elem_price=0}}else{if(isLabel)return"";elem_price=0}break;case"percentage":if(value){var $item_parent=$ele.parents(".wcpa_form_item"),item_type=$item_parent.data("type");if(item_type&&"productGroup"===item_type)if($product_qty_ele=$ele.parents(".wcpa_productGroup_item").find("input[type=number]"),$product_qty_ele.length){var qty=parseInt($product_qty_ele.val());qty=qty||0===qty?qty:0,elem_price=parseFloat(element_data.option_price)*price*qty/100}else elem_price=parseFloat(element_data.option_price)*price/100;else elem_price=price*$product_data.wc_product_price/100}else elem_price=0}return elem_price}function wcpa_get_date_obj(e,a){return a=void 0!==a&&a,"function"==typeof moment?"wp"==a?moment(e,wcpa_global_vars.date_format_js+" "+wcpa_global_vars.time_format_js).toDate():!1!==a?moment(e,a).toDate():moment(e).toDate():new Date(e)}function date_data_from_field(e,a){var t=0;switch(a.data("type")){case"date":case"datetime-local":case"time":if("days"==e)t="function"!=typeof(i=wcpa_get_date_obj(a.find("input").val(),"wp")).getTime||isNaN(i.getTime())?0:(i.getTime()-new Date("1970/01/01").getTime())/864e5;else if("timestamp"==e||"seconds"==e){var i;t="function"!=typeof(i=wcpa_get_date_obj(a.find("input").val(),"wp")).getTime||isNaN(i.getTime())?0:(i.getTime()-new Date("1970/01/01").getTime())/1e3}break;default:t=0}return t}function get_data_from_field(e,a){switch($ele_outer=a.parents(".wcpa_form_item"),val=0,$ele_outer.data("type")){case"select":"count"==e&&(val=$ele_outer.find("select").val()?1:0);break;case"textarea":"count"==e&&(val=a.val()?1:0);break;case"file":if("count"==e||"selected"==e)if($ele_outer.find("input[type=hidden]").length){var t="",i=$ele_outer.find("input[type=hidden]").val(),r=!1;if(i?(t=i,r=!0):a[0].files?val=a[0].files.length?a[0].files.length:0:a.val()&&(t=a.val(),r=!0),r)if(a.hasClass("wcpa_multiple")){if(t&&(files=JSON.parse(t),files)){var p=0;$.each(files,((e,a)=>{a&&p++})),val=p}}else val=1}else a[0].files&&(val=a[0].files.length?a[0].files.length:0);break;case"checkbox-group":case"radio-group":case"color-group":case"image-group":case"productGroup":"count"==e&&(val=0,1==a.prop("checked")?val=1:val=0);break;default:"count"==e&&(val=$ele_outer.find("input").val()?1:0)}return val}function preview_image(){jQuery(".wcpa_type_image-group .wcpa_image .wcpa_img_mag").not(".wcpa_even_binded").on("click",(function(e){var a=$(this).parents(".wcpa_image").find("label").text(),t=a||"";jQuery("body").append("<div id='wcpa_img_popup_outer'><div class='wcpa_img_popup'><img src='"+$(this).attr("data-src")+"' alt='Image preview' /><span>"+t+"</span></div></div>"),jQuery("#wcpa_img_popup_outer").fadeIn("fast").on("click",(function(){$(this).fadeOut("fast").remove()}))})).addClass("wcpa_even_binded"),jQuery(".wcpa_type_productGroup .wcpa_productGroup_option_img .wcpa_img_mag").not(".wcpa_even_binded").on("click",(function(e){var a=$(this).data("title"),t=a||"";jQuery("body").append("<div id='wcpa_img_popup_outer'><div class='wcpa_img_popup'><img src='"+$(this).attr("data-src")+"' alt='Image preview' /><span>"+t+"</span></div></div>"),jQuery("#wcpa_img_popup_outer").fadeIn("fast").on("click",(function(){$(this).fadeOut("fast").remove()}))})).addClass("wcpa_even_binded"),jQuery(".wcpa_img_preview .wcpa_image img,.wcpa_cart_img_preview img,.wcpa_product_img_preview img").not(".wcpa_even_binded").hover((function(e){var a=!0;if($(this).parents(".wcpa_form_item").find(".wcpa_product_img_preview_disable_mobile").length&&$(window).width()<=480&&(a=!1),a){var t=$(this).parent(".wcpa_image").find("label").text(),i=t||"";jQuery("body").append("<div id='wcpa_img_preview'><img src='"+$(this).data("src")+"' alt='Image preview' />"+i+"</div>"),jQuery("#wcpa_img_preview").css("top",e.pageY-10+"px").css("left",e.pageX-30-jQuery("#wcpa_img_preview").width()+"px").fadeIn("fast")}}),(function(){jQuery("#wcpa_img_preview").remove()})).addClass("wcpa_even_binded"),jQuery(".wcpa_img_preview .wcpa_image img,.wcpa_cart_img_preview img").not(".wcpa_even_binded").mousemove((function(e){var a=!0;if($(this).parents(".wcpa_form_item").find(".wcpa_product_img_preview_disable_mobile").length&&$(window).width()<=480&&(a=!1),a){var t=$(window).scrollTop()+$(window).height(),i=e.pageY+jQuery("#wcpa_img_preview").height(),r=e.pageY-jQuery("#wcpa_img_preview").height();if($(window).scrollTop()-r<i-t)var p=e.pageY-10-jQuery("#wcpa_img_preview").height();else p=e.pageY+10;if(e.pageX-jQuery("#wcpa_img_preview").width()<0&&$(window).width()-(e.pageX+jQuery("#wcpa_img_preview").width())>e.pageX-jQuery("#wcpa_img_preview").width()){var n=e.pageX+30;jQuery("#wcpa_img_preview").css("top",p+"px").css("right","auto").css("left",n+"px")}else{var c=$(window).width()-(e.pageX+30);jQuery("#wcpa_img_preview").css("top",p+"px").css("left","auto").css("right",c+"px")}}})).addClass("wcpa_even_binded")}function wcpa_validate_form(e=""){var a=!0;if($form_outer=$(".wcpa_form_outer"),e){var t=wcpa_validate_field($(e));""!=t.element&&(t.success?($(e).find(".wcpa_error_msg").remove(),t.element&&t.element.removeClass("wcpa_validation_error")):(t.appendAfter.siblings(".wcpa_error_msg").remove(),$error_ele=$('<div class="wcpa_error_msg"><p>'+t.message+"</p></div>").insertAfter(t.appendAfter),t.element.addClass("wcpa_validation_error"),a=!1)),wcpa_validate_charector_count($(e))}else $form_outer.find(".wcpa_form_item.wcpa_validate_field").each(((e,t)=>{var i=wcpa_validate_field($(t));""!=i.element&&(i.success?($(t).find(".wcpa_error_msg").remove(),i.element&&$(i.element).removeClass("wcpa_validation_error")):(i.appendAfter.siblings(".wcpa_error_msg").remove(),$error_ele=$('<div class="wcpa_error_msg"><p>'+i.message+"</p></div>").insertAfter(i.appendAfter),$(i.element).addClass("wcpa_validation_error"),a=!1)),wcpa_validate_charector_count($(t))}));return a}function wcpa_validate_field(e){var a={success:!0,message:"",appendAfter:"",element:""},t="",i=e.data("type");switch(i){case"text":if(!wcpa_check_form_visibility(t=e.find("input"),e))break;var r=t.data("validation"),p=t.val();if(r)if(p){if(r.allowed_chars_enable)for(var n=regExpFromString(r.allowed_chars,"i"),c="",l=0;l<p.length;l++){if(n.test(p.charAt(l)))p.charAt(l);else c+=p.charAt(l),a={success:!1,message:r.allowed_charsMessage.replace("%s",c),appendAfter:t}}r.pattern&&(compareRegExpWithString(p,r.pattern)||(a={success:!1,message:r.patternMessage,appendAfter:t})),r.maxlength&&p.length>r.maxlength&&(a={success:!1,message:r.maxlengthMessage,appendAfter:t}),r.minlength&&p.length<r.minlength&&(a={success:!1,message:r.minlengthMessage,appendAfter:t})}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t});break;case"color":case"time":case"date":case"datetime-local":if(!wcpa_check_form_visibility(t=e.find("input"),e))break;r=t.data("validation"),p=t.val();r&&r.required&&(!p||p&&-1!==p.indexOf("__"))&&(a={success:!1,message:r.requiredMessage,appendAfter:t});break;case"number":if(!wcpa_check_form_visibility(t=e.find("input"),e))break;r=t.data("validation"),p=t.val();r&&(p?(r.pattern&&(compareRegExpWithString(p,r.pattern)||(a={success:!1,message:r.patternMessage,appendAfter:t})),r.max&&parseFloat(p)>parseFloat(r.max)&&(a={success:!1,message:r.maxMessage,appendAfter:t}),r.min&&parseFloat(p)<parseFloat(r.min)&&(a={success:!1,message:r.minMessage,appendAfter:t}),r.maxlength&&p.length>parseInt(r.maxlength)&&(a={success:!1,message:r.maxlengthMessage,appendAfter:t}),r.minlength&&p.length<parseInt(r.minlength)&&(a={success:!1,message:r.minlengthMessage,appendAfter:t})):r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t}));break;case"textarea":if(!wcpa_check_form_visibility(t=e.find("textarea"),e))break;r=t.data("validation"),p=t.val();if(r)if(p){if(r.allowed_chars_enable)for(n=regExpFromString(r.allowed_chars,"i"),c="",l=0;l<p.length;l++){if(n.test(p.charAt(l)))p.charAt(l);else c+=p.charAt(l),a={success:!1,message:allowed_charsMessage.replace("%s",c),appendAfter:t}}r.maxlength&&p.length>r.maxlength&&(a={success:!1,message:r.maxlengthMessage,appendAfter:t}),r.minlength&&p.length<r.minlength&&(a={success:!1,message:r.minlengthMessage,appendAfter:t})}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t});break;case"checkbox-group":if(!wcpa_check_form_visibility(t=e.find(".checkbox-group"),e))break;if(r=t.data("validation")){var s=!1,o=!1;if(t.find("input[type=checkbox]:not(.wcpa_other):checked").length&&(s=!0),t.find("input[type=checkbox]:checked.wcpa_other").length&&t.find("input.wcpa_other_val").val()&&(o=!0),s||o){if(r.min){var _=0;t.find("input[type=checkbox]:checked").each((function(e,a){$(a).hasClass("wcpa_other")?t.find("input.wcpa_other_val").val()&&_++:_++})),_<r.min&&(a={success:!1,message:r.minMessage,appendAfter:t})}if(r.max){_=0;t.find("input[type=checkbox]:checked").each((function(e,a){$(a).hasClass("wcpa_other")?t.find("input.wcpa_other_val").val()&&_++:_++})),_>r.max&&(a={success:!1,message:r.maxMessage,appendAfter:t})}}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t});r.other&&t.find("input[type=checkbox]:checked.wcpa_other").length&&(t.find("input.wcpa_other_val").val()||(a={success:!1,message:r.otherRequiredMessage,appendAfter:t}))}break;case"radio-group":if(!wcpa_check_form_visibility(t=e.find(".radio-group"),e))break;if((r=t.data("validation"))&&r.required){s=!1;var d=!1;t.find("input[type=radio]:checked").length&&(s=!0),t.find("input[type=radio]:checked.wcpa_other").length&&(t.find("input.wcpa_other_val").val()||(d=!0)),s&&!d||(a={success:!1,message:r.requiredMessage,appendAfter:t})}break;case"file":if(e.find(".wcpa_drag_drop").length){if(!wcpa_check_form_visibility(t=e.find(".wcpa_drag_drop"),e))break;r=(h=e.find('input[type="hidden"]')).data("validation");var u=e.find(".wcpa-upload-message"),f=h.hasClass("wcpa_multiple");if(r){var m=h.val();s=!1;if(m&&f){var w=JSON.parse(m);$.each(w,(function(e,a){a&&(s=!0)}))}else m&&(s=!0);if(s){if(r.maxFileCount)if((m=h.val())&&f){w=JSON.parse(m),_=0;$.each(w,(function(e,a){a&&_++})),_>r.maxFileCount&&(a={success:!1,message:r.maxFileCountMessage,appendAfter:u})}}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:u})}}else if(e.find('input[type="hidden"]').length){if(!wcpa_check_form_visibility(t=e.find(".wcpa_file_outer"),e))break;var h=e.find('input[type="hidden"]'),g=e.find('input[type="file"]');r=h.data("validation"),f=g.hasClass("wcpa_multiple");if(r){m=h.val(),s=!1;if(f&&m){w=JSON.parse(m);$.each(w,(function(e,a){a&&(s=!0)}))}else m&&(s=!0);if(s){if(r.maxFileCount)if((m=h.val())&&f){w=JSON.parse(m),_=0;$.each(w,(function(e,a){a&&_++})),_>r.maxFileCount&&(a={success:!1,message:r.maxFileCountMessage,appendAfter:h})}}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:h})}}else if(e.find(".wcpa_file_outer").length){if(!wcpa_check_form_visibility(t=e.find(".wcpa_file_outer"),e))break;f=(h=e.find("input")).hasClass("wcpa_multiple");if(r=h.data("validation"))if(h.val()){if(r.minFileSize)if(m=h.val())if(x=h.prop("files")){var v=!1;$.each(x,(function(e,a){a&&a.size<r.minFileSize&&(v=!0)})),v&&(a={success:!1,message:r.minFileSizeMessage,appendAfter:t})}if(r.maxFileSize)if(m=h.val())if(x=h.prop("files")){v=!1;$.each(x,(function(e,a){a&&a.size>r.maxFileSize&&(v=!0)})),v&&(a={success:!1,message:r.maxFileSizeMessage,appendAfter:t})}if(r.extensionSupportEnable)if(m=h.val()){var y=r.extensions.split(",");if(x=h.prop("files")){var b=!1;$.each(x,(function(e,a){var t=a.name.split(".").pop().toLowerCase();y.indexOf(t)<=-1&&(b=!0)})),b&&(a={success:!1,message:r.extensionsInvalidMessage,appendAfter:t})}}if(r.maxFileCount)if((m=h.val())&&f)(x=h.prop("files"))&&x.length>r.maxFileCount&&(a={success:!1,message:r.maxFileCountMessage,appendAfter:t})}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t})}else{if(!wcpa_check_form_visibility(t=e.find("input"),e))break;f=t.hasClass("wcpa_multiple");if(r=t.data("validation"))if(t.val()){if(r.minFileSize)if(m=t.val())if(x=t.prop("files")){v=!1;$.each(x,(function(e,a){a&&a.size<r.minFileSize&&(v=!0)})),v&&(a={success:!1,message:r.minFileSizeMessage,appendAfter:t})}if(r.maxFileSize)if(m=t.val())if(x=t.prop("files")){v=!1;$.each(x,(function(e,a){a&&a.size>r.maxFileSize&&(v=!0)})),v&&(a={success:!1,message:r.maxFileSizeMessage,appendAfter:t})}if(r.extensionSupportEnable)if(m=t.val()){var x;y=r.extensions.split(",");if(x=t.prop("files")){b=!1;$.each(x,(function(e,a){var t=a.name.split(".").pop().toLowerCase();y.indexOf(t)<=-1&&(b=!0)})),b&&(a={success:!1,message:r.extensionsInvalidMessage,appendAfter:t})}}if(r.maxFileCount)if((m=t.val())&&f)(x=t.prop("files"))&&x.length>r.maxFileCount&&(a={success:!1,message:r.maxFileCountMessage,appendAfter:t})}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t})}break;case"select":if(!wcpa_check_form_visibility(t=e.find(".select"),e))break;h=e.find("select");if(r=h.data("validation"))if(h.attr("required"))(m=h.val()).length||(a={success:!1,message:r.requiredMessage,appendAfter:e.find(".select")});break;case"image-group":case"color-group":if(!wcpa_check_form_visibility(t=e.find("."+i),e))break;if(r=t.data("validation")){s=!1;var k=!1,q="radio";if(t.hasClass("wcpa_multiselect")&&(q="checkbox"),t.find("input[type="+q+"]:not(.wcpa_other):checked").length&&(s=!0),t.find("input[type="+q+"]:checked.wcpa_other").length&&t.find("input.wcpa_other_val").val()&&(k=!0),s||k){if(t.find("input[type=checkbox]").length){if(r.min){_=0;t.find("input[type=checkbox]:checked").each((function(e,a){$(a).hasClass("wcpa_other")?t.find("input.wcpa_other_val").val()&&_++:_++})),_<r.min&&(a={success:!1,message:r.minMessage,appendAfter:t})}if(r.max){_=0;t.find("input[type=checkbox]:checked").each((function(e,a){$(a).hasClass("wcpa_other")?t.find("input.wcpa_other_val").val()&&_++:_++})),_>r.max&&(a={success:!1,message:r.maxMessage,appendAfter:t})}}}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t});r.other&&t.find("input[type="+q+"]:checked.wcpa_other").length&&(t.find("input.wcpa_other_val").val()||(a={success:!1,message:r.otherRequiredMessage,appendAfter:t}))}break;case"productGroup":if(!wcpa_check_form_visibility(t=e.find(".wcpa_"+i),e))break;r=t.data("validation"),q="radio";if(t.hasClass("wcpa_multiselect")&&(q="checkbox"),r)if(t.find("input[type="+q+"]:checked").length){if(t.find("input[type=checkbox]").length){if(r.min)(_=t.find("input[type=checkbox]:checked").length)<r.min&&(a={success:!1,message:r.minMessage,appendAfter:t});if(r.max)(_=t.find("input[type=checkbox]:checked").length)>r.max&&(a={success:!1,message:r.maxMessage,appendAfter:t})}if(r.qty&&t.find("input[type="+q+"]:checked").length){$products=t.find("input[type="+q+"]:checked");var A=!1;$.each($products,((e,a)=>{if($(a).siblings("input[type=number]").length){var t=$(a).siblings("input[type=number]").val();(void 0===t||""===t||t<=0||t.indexOf(".")>-1)&&(A=!0)}})),A&&(a={success:!1,message:r.qtyMessage,appendAfter:t})}}else r.required&&(a={success:!1,message:r.requiredMessage,appendAfter:t});break;case"placeselector":if(!wcpa_check_form_visibility(t=e.find("input.wcpa_google_place"),e))break;(r=t.data("validation"))&&t.attr("required")&&(t.val()||(a={success:!1,message:r.requiredMessage,appendAfter:t}));break;default:a={success:!0,message:"",appendAfter:""}}return a.element=t,a}function wcpa_validate_charector_count(e){var a={success:!1,message:""},t="";switch(e.data("type")){case"text":case"number":t=e.find("input");break;case"textarea":t=e.find("textarea");break;default:t=""}if(t){if(!wcpa_check_form_visibility(t,e))return;var i=t.data("validation"),r=t.val();if(i&&r&&i.maxlength&&i.charleft){var p=i.maxlength-r.length;p>=0&&(a={success:!0,message:i.charleftMessage.replace("%s",p)})}a.success?(e.find(".wcpa_char_left_message").show(),e.find(".wcpa_char_left_message p").text(a.message)):e.find(".wcpa_char_left_message").hide()}}function wcpa_check_form_visibility(e,a){return!!(e.parent().is(":visible")||a.is(".wcpa_visible")||a.is(".wcpa_visible_parent"))}$.wcpaInit=function(){preview_image(),$(".cart_item.wcpa_bind_quantity.wcpa_cart_has_fields .quantity .qty").attr("readonly","readonly"),$(".wcpa_tooltip_icon").not(".wcpa_even_binded").hover((function(){$that=$(this),setTimeout((function(){if($ele=$(".wcpa_tooltip",$that).get(0),"function"==typeof $ele.getBoundingClientRect){var e=$ele.getBoundingClientRect(),a=$that.get(0).getBoundingClientRect();e.x+e.width>$(window).width()&&($(".wcpa_tooltip",$that).css("left","-"+Math.min(e.x-parseInt(($(window).width()-e.width)/2),e.width-20)+"px"),$(".wcpa_tooltip",$that).css("border-radius","5px")),a.top-e.height<0?($that.addClass("wcpa_show_down"),$(".wcpa_tooltip",$that).css("bottom","-"+e.height-6+"px"),$(".wcpa_tooltip",$that).css("border-radius"," 0px 5px 5px 5px")):($(".wcpa_tooltip",$that).css("bottom",""),$that.removeClass("wcpa_show_down"))}}),0)}),(function(){$(".wcpa_tooltip",$(this)).css("left","2px"),$(".wcpa_tooltip",$(this)).css("border-radius","5px 5px 5px 0")})).addClass("wcpa_even_binded"),$(".wcpa_form_outer").each((function(){var e=$(this);if(void 0!==e.data("wcpa"))return!0;("undefined"!=typeof wcpa_global_vars&&($(".wcpa_datepicker",e).length&&$(".wcpa_datepicker",e).each((function(){var e=$(this).data("dpconf");null==e&&(e={}),$(this).datetimepicker($.extend({timepicker:!1,validateOnBlur:!1,scrollInput:!1,dayOfWeekStart:wcpa_global_vars.start_of_week,format:wcpa_global_vars.date_format},e))})),$(".wcpa_datetimepicker",e).length&&$(".wcpa_datetimepicker",e).each((function(){var e=$(this).data("dpconf");null==e&&(e={}),$(this).datetimepicker($.extend({format:wcpa_global_vars.date_format+" "+wcpa_global_vars.time_format,validateOnBlur:!1,dayOfWeekStart:wcpa_global_vars.start_of_week,scrollInput:!1,step:15},e))})),$(".wcpa_timepicker",e).length&&$(".wcpa_timepicker",e).each((function(){var e=$(this).data("dpconf");null==e&&(e={}),$(this).datetimepicker($.extend({datepicker:!1,format:wcpa_global_vars.time_format,validateOnBlur:!1,scrollInput:!1,step:15},e))})),$(".wcpa_colorpicker",e).length&&$(".wcpa_colorpicker",e).spectrum({preferredFormat:"hex",showInput:!0,allowEmpty:!0}),void 0!==$.datetimepicker&&""!==document.documentElement.lang&&$.datetimepicker.setLocale(document.documentElement.lang.substring(0,2)),$(".wcpa_type_select .select select").each((function(){var e=!1,a=!1;($(this).hasClass("wcpa_use_sumo_individual")||wcpa_global_vars.use_sumo&&$(this).attr("multiple"))&&(e=!0,$(this).data("placeholder")&&(a=!0)),e&&(a?$(this).SumoSelect({placeholder:$(this).data("placeholder"),captionFormat:wcpa_global_vars.strings.sumo_strings.captionFormat,captionFormatAllSelected:wcpa_global_vars.strings.sumo_strings.captionFormatAllSelected}):$(this).SumoSelect({captionFormat:wcpa_global_vars.strings.sumo_strings.captionFormat,captionFormatAllSelected:wcpa_global_vars.strings.sumo_strings.captionFormatAllSelected}))}))),e.parents("form").find("button[name=add-to-cart], .single_add_to_cart_button").on("click",(function(e){if($(this).hasClass("disabled"))e.preventDefault();else if($(this).is(".wcpa_disable_cart"))alert(wcpa_global_vars.strings.ajax_file_upload),e.preventDefault();else{if(wcpa_validate_form()){if($(document).find(".wcpa_drag_drop input.wcpa_dynamic_file_uploader").length&&$(document).find(".wcpa_drag_drop input.wcpa_dynamic_file_uploader").remove(),wcpa_global_vars.ajax_add_to_cart){e.preventDefault();var a=$(this);a.removeClass("added"),a.addClass("loading");var t=$(this).parents("form.cart"),i=t.find('input:not([name="product_id"]), select, button, textarea').wcpa_serializeArrayAll()||0;$.each(i,(function(e,i){"add-to-cart"==i.name&&(i.name="product_id",i.value=t.find("input[name=variation_id]").val()||a.val())})),$.ajax({type:"POST",url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","add_to_cart"),data:i,success:function(e){e&&(e.error&&e.product_url?window.location=e.product_url:wc_add_to_cart_params&&"yes"===wc_add_to_cart_params.cart_redirect_after_add?window.location=wc_add_to_cart_params.cart_url:$(document.body).trigger("added_to_cart",[e.fragments,e.cart_hash,a]))},error:function(e){}})}}else if(e.preventDefault(),$(".wcpa_form_outer .wcpa_validation_error:first").parents(".wcpa_form_item").offset().top){var r=$(".wcpa_form_outer .wcpa_validation_error:first").parents(".wcpa_form_item").offset().top,p=$(window).height(),n=$(".wcpa_form_outer .wcpa_validation_error:first").parents(".wcpa_form_item").outerHeight();$("html,body").animate({scrollTop:r-p/2+n/2},1e3)}}})),$([".wcpa_type_checkbox-group .wcpa_required input",".wcpa_type_radio-group .wcpa_required input",".wcpa_type_image-group .wcpa_required input",".wcpa_type_color-group .wcpa_required input",".wcpa_type_productGroup .wcpa_required input"].join(","),e).on("change",(function(){var e=$(this).parents(".wcpa_form_item");$(".wcpa_required input[type=checkbox]",e).length?0!=$(".wcpa_required input[type=checkbox]:checked",e).not(".wcpa_other").length||0!=$(".wcpa_required .wcpa_other_val",e).length&&""!=$(".wcpa_required .wcpa_other_val",e).val()?$(".wcpa_required input[type=checkbox]:first",e).removeAttr("required"):$(".wcpa_required input[type=checkbox]:first",e).attr("required","required"):$(".wcpa_required input[type=radio]",e).length&&(0!=$(".wcpa_required input[type=radio]:checked",e).not(".wcpa_other").length||0!=$(".wcpa_required .wcpa_other_val",e).length&&""!=$(".wcpa_required .wcpa_other_val",e).val()?($(".wcpa_required input[type=radio]:first",e).removeAttr("required"),$(".wcpa_required .wcpa_other_val",e).removeAttr("required")):($(".wcpa_required input[type=radio]:first",e).attr("required","required"),$(".wcpa_required input[type=radio].wcpa_other",e).is(":checked")&&$(".wcpa_required .wcpa_other_val",e).attr("required","required")))})),$(".wcpa_file_custom",e).on("keyup change",(function(){wcpa_upload_file($(this))})),$(".wcpa_progress span",e).on("click",(function(){wcpa_remove_file($(this).parents(".wcpa_form_item").find(".wcpa_file_custom"))})),$(".wcpa_remove_file",e).on("click",(function(){$(this).parents(".wcpa_form_item").find(".wcpa_file_name").html(""),$(this).parents(".wcpa_form_item").find(".wcpa_file_hidden").val("").trigger("change"),$(this).parents(".wcpa_form_item").find(".wcpa_upload_preview").html(""),$(this).hide(),$(this).parents(".wcpa_form_item").find(".wcpa_file_custom").val("").trigger("change")})),$(".wcpa_clearSelection",e).on("click",(function(e){$("input",$("#"+$(this).data("element"))).prop("checked",!1),$("input",$("#"+$(this).data("element"))).trigger("change"),e.preventDefault()})),$(".image-group .wcpa_image img",e).on("click",(function(){var e=$("#"+$(this).attr("attrfor"));e.prop("checked",!e.prop("checked")),e.trigger("change")})),$(".color-group .wcpa_color label",e).on("click",(function(){var e=$("#"+$(this).attr("for")),a=e.prop("checked");setTimeout((function(){a&&(e.prop("checked",!1),e.trigger("change"))}),0),e.trigger("change")})),$(".wcpa_other_val",e).on("keyup change",(function(){$.trim($(this).val()).length>0?$(this).siblings(".wcpa_other").val("WCPAOTH "+$(this).val()):$(this).siblings(".wcpa_other").val("")})),e.on("wcpa_trigger_update",(function(a){iterate(e)})),"undefined"!=typeof wcpa_global_vars&&e.data("product").is_variable)&&(e.parents("form").find(".single_variation_wrap").on("show_variation",(function(a,t){var i=e.data("product");i.wc_product_price=t.display_price/i.con_unit,i.stock_status=t.stock_status,i.stock_quantity=t.stock_quantity,e.data("product",i),iterate(e)})),e.parents("form").on("reset_data",(function(a){var t=e.data("product");t.wc_product_price=t.wc_product_price_default,e.data("product",t),iterate(e)})),e.parents("form").on("reset_image",(function(a){setTimeout((function(){iterate(e)}),0)})),e.parents("form").on("woocommerce_variation_has_changed",(function(e){var a=$(this).find(".wcpa_form_outer"),t=a.data("attrrelated");null!=t&&t.forEach((function(e){exc_relations(e,a)}))})));if($([".wcpa_has_price",".wcpa_has_price ~ .wcpa_other_val",".wcpa_has_price_related input",".wcpa_has_price_related select",".wcpa_has_price_related textarea",".wcpa_product_quantity"].join(","),e).on("keyup change",(function(){iterate(e)})),$(".wcpa_productGroup input[type=checkbox]").on('"keyup change',(function(){1==$(this).prop("checked")?($quantity_input=$(this).siblings("input.wcpa_product_quantity"),$quantity_input.prop("disabled","")):($quantity_input=$(this).siblings("input.wcpa_product_quantity"),$quantity_input.prop("disabled","disabled"))})),$(".wcpa_productGroup input[type=radio]").on('"keyup change',(function(){$radioParent=$(this).parents(".wcpa_productGroup"),$radioParent.find("input.wcpa_product_quantity").prop("disabled","disabled"),1==$(this).prop("checked")&&($quantity_input=$(this).siblings("input.wcpa_product_quantity"),$quantity_input.prop("disabled",""))})),$(".wcpa_update_product_image",e).on("keyup change",(function(){iterate(e)})),$("input[name=quantity]",e.parents("form")).length){var a=e.data("qntyrelated");null!=a&&a.forEach((function(a){exc_relations(a,e)}))}$("input[name=quantity]",e.parents("form")).on("keyup change",(function(){var a=e.data("qntyrelated");null!=a&&a.forEach((function(a){exc_relations(a,e)})),iterate(e)})),$(".wcpa_has_relation input,.wcpa_has_relation select,.wcpa_has_relation textarea",e).on("keyup change",(function(){var a=$(this).parents(".wcpa_has_relation").data("related");null!=a&&a.forEach((function(a){exc_relations(a,e)}))})),$(".wcpa_has_relation",e).each((function(){var a=$(this).data("related");null!=a&&a.forEach((function(a){exc_relations(a,e)}))})),$([".wcpa_has_label_related input",".wcpa_has_label_related select",".wcpa_has_label_related textarea"].join(","),e).on("keyup change",(function(){var a=$(this).parents(".wcpa_has_label_related").data("label_depends");null!=a&&a.forEach((function(a){exc_Label(a,e)}))})),$(".wcpa_has_label_related",e).each((function(){var a=$(this).data("label_depends");null!=a&&a.forEach((function(a){exc_Label(a,e)}))})),$(".wcpa_has_label_formula",e).removeClass("wcpa_hide"),$(".wcpa_has_value_formula",e).removeClass("wcpa_hide"),e.data("wcpa",{}),iterate(e);var t=e.data("attrrelated");null!=t&&t.forEach((function(a){exc_relations(a,e)})),$(".variations_form .variations").length&&setTimeout((function(){$(".variations_form  .variations select").trigger("change")}),0),wcpa_may_update_quantity(e)})),jQuery(document.body).on("wc_booking_form_changed",(function(){var e=$(".wc-bookings-booking-cost .woocommerce-Price-amount bdi").clone().children().remove().end().text();e&&$(".wcpa_form_outer").each(((a,t)=>{$form_outer=$(t);var i=$form_outer.data("product");i.wc_product_price=e,$form_outer.data("product",i),iterate($form_outer)}))}))},$(document).ready((function(){$([".wcpa_form_outer .wcpa_form_item.wcpa_validate_field input",".wcpa_form_outer .wcpa_form_item.wcpa_validate_field textarea",".wcpa_form_outer .wcpa_form_item.wcpa_validate_field select",".wcpa_form_outer .wcpa_form_item.wcpa_validate_field button"].join(",")).on("keyup change",(function(e){$(this).parents(".wcpa_form_item").length&&wcpa_validate_form($(this).parents(".wcpa_form_item"))}))})),$(document).ready((function(){$.wcpaInit()})),$.wcpaIterate=function(){$(".wcpa_form_outer").each((function(){iterate($(this))}))}}(jQuery),wcpa_global_vars.wcpa_init_triggers.length&&jQuery(document).on(wcpa_global_vars.wcpa_init_triggers.join(" "),(function(){jQuery.wcpaInit()})),jQuery(document).ready((function(e){setTimeout((function(){jQuery.wcpaInit()}),1e3)}));